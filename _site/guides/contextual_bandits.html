<!doctype html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="/vowpalwabbit.github.io/assets/images/favicon.png">
    <link rel="stylesheet" href="/vowpalwabbit.github.io/assets/bootstrap-4.1.3-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/vowpalwabbit.github.io/assets/syntax.css">
    <link rel="stylesheet" href="/vowpalwabbit.github.io/assets/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Work+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="/vowpalwabbit.github.io/assets/nav.js"></script>
    <title>Get started with Contextual Bandits</title>
  </head>
  <body class=tutorial>
    

<div class="container-fluid nav_bar_container">
  <div class="container navbar navbar-expand-lg">
    <div class="logo">
      <a href="/vowpalwabbit.github.io">
        <?xml version="1.0" encoding="UTF-8"?>
<svg width="260px" height="45px" viewBox="0 0 260 45" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 53 (72520) - https://sketchapp.com -->
    <title>VW_Logo_Lock_up</title>
    <desc>Created with Sketch.</desc>
    <defs>
        <polygon id="path-1" points="0 0 42 0 42 45 0 45"></polygon>
    </defs>
    <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="HD_Desktop_header_Home" transform="translate(-258.000000, -44.000000)">
            <g id="Header">
                <g id="VW_Logo" transform="translate(258.000000, 28.000000)">
                    <g transform="translate(27.000000, 0.000000)" fill="#FFFFFF" id="Logo">
                        <g transform="translate(30.000000, 31.000000)">
                            <path d="M10.632,22 L5.784,22 L0.144,6.16 L4.488,6.16 L7.392,15.736 L8.256,18.856 L9.096,15.784 L12.048,6.16 L16.248,6.16 L10.632,22 Z M24.816,5.92 C26.416008,5.92 27.7959942,6.24399676 28.956,6.892 C30.1160058,7.54000324 31.0079969,8.47599388 31.632,9.7 C32.2560031,10.9240061 32.568,12.3839915 32.568,14.08 C32.568,15.7760085 32.2560031,17.2359939 31.632,18.46 C31.0079969,19.6840061 30.1160058,20.6199968 28.956,21.268 C27.7959942,21.9160032 26.416008,22.24 24.816,22.24 C23.215992,22.24 21.8320058,21.9160032 20.664,21.268 C19.4959942,20.6199968 18.6000031,19.6840061 17.976,18.46 C17.3519969,17.2359939 17.04,15.7760085 17.04,14.08 C17.04,12.3839915 17.3519969,10.9240061 17.976,9.7 C18.6000031,8.47599388 19.4959942,7.54000324 20.664,6.892 C21.8320058,6.24399676 23.215992,5.92 24.816,5.92 Z M24.816,9.16 C23.6639942,9.16 22.784003,9.57599584 22.176,10.408 C21.567997,11.2400042 21.264,12.4639919 21.264,14.08 C21.264,15.6960081 21.567997,16.9199958 22.176,17.752 C22.784003,18.5840042 23.6639942,19 24.816,19 C25.9680058,19 26.843997,18.5840042 27.444,17.752 C28.044003,16.9199958 28.344,15.6960081 28.344,14.08 C28.344,12.4639919 28.044003,11.2400042 27.444,10.408 C26.843997,9.57599584 25.9680058,9.16 24.816,9.16 Z M42.72,22 L38.088,22 L33.528,6.16 L37.968,6.16 L40.584,18.76 L43.44,6.16 L47.184,6.16 L50.088,18.736 L52.704,6.16 L56.976,6.16 L52.392,22 L47.904,22 L46.032,14.32 L45.312,10.456 L45.264,10.456 L44.568,14.32 L42.72,22 Z M66.24,6.16 C68.2080098,6.16 69.7199947,6.61199548 70.776,7.516 C71.8320053,8.42000452 72.36,9.71999152 72.36,11.416 C72.36,13.0320081 71.8320053,14.2839956 70.776,15.172 C69.7199947,16.0600044 68.2080098,16.504 66.24,16.504 L63.096,16.504 L63.096,22 L58.968,22 L58.968,6.16 L66.24,6.16 Z M65.592,13.48 C66.4880045,13.48 67.1479979,13.3080017 67.572,12.964 C67.9960021,12.6199983 68.208,12.0880036 68.208,11.368 C68.208,10.6639965 67.9960021,10.1400017 67.572,9.796 C67.1479979,9.45199828 66.4880045,9.28 65.592,9.28 L63.096,9.28 L63.096,13.48 L65.592,13.48 Z M82.464,18.424 L76.992,18.424 L75.888,22 L71.736,22 L77.304,6.16 L82.248,6.16 L87.792,22 L83.544,22 L82.464,18.424 Z M81.6,15.616 L80.448,11.824 L79.752,9.328 L79.704,9.328 L79.056,11.8 L77.856,15.616 L81.6,15.616 Z M101.712,18.808 L101.712,22 L89.64,22 L89.64,6.16 L93.768,6.16 L93.768,18.808 L101.712,18.808 Z M117.648,22 L113.016,22 L108.456,6.16 L112.896,6.16 L115.512,18.76 L118.368,6.16 L122.112,6.16 L125.016,18.736 L127.632,6.16 L131.904,6.16 L127.32,22 L122.832,22 L120.96,14.32 L120.24,10.456 L120.192,10.456 L119.496,14.32 L117.648,22 Z M141.624,18.424 L136.152,18.424 L135.048,22 L130.896,22 L136.464,6.16 L141.408,6.16 L146.952,22 L142.704,22 L141.624,18.424 Z M140.76,15.616 L139.608,11.824 L138.912,9.328 L138.864,9.328 L138.216,11.8 L137.016,15.616 L140.76,15.616 Z M148.8,6.16 L156.504,6.16 C160.312019,6.17600008 162.216,7.59998584 162.216,10.432 C162.216,11.3600046 161.944003,12.1439968 161.4,12.784 C160.855997,13.4240032 160.056005,13.8239992 159,13.984 L159,14.008 C160.184006,14.1680008 161.083997,14.5799967 161.7,15.244 C162.316003,15.9080033 162.624,16.735995 162.624,17.728 C162.624,19.1040069 162.136005,20.1599963 161.16,20.896 C160.183995,21.6320037 158.752009,22 156.864,22 L148.8,22 L148.8,6.16 Z M155.76,12.64 C157.248007,12.64 157.992,12.0640058 157.992,10.912 C157.992,9.75999424 157.248007,9.184 155.76,9.184 L152.784,9.184 L152.784,12.64 L155.76,12.64 Z M156.168,19.096 C156.904004,19.096 157.459998,18.9440015 157.836,18.64 C158.212002,18.3359985 158.4,17.8960029 158.4,17.32 C158.4,16.7599972 158.212002,16.3320015 157.836,16.036 C157.459998,15.7399985 156.904004,15.592 156.168,15.592 L152.784,15.592 L152.784,19.096 L156.168,19.096 Z M165.216,6.16 L172.92,6.16 C176.728019,6.17600008 178.632,7.59998584 178.632,10.432 C178.632,11.3600046 178.360003,12.1439968 177.816,12.784 C177.271997,13.4240032 176.472005,13.8239992 175.416,13.984 L175.416,14.008 C176.600006,14.1680008 177.499997,14.5799967 178.116,15.244 C178.732003,15.9080033 179.04,16.735995 179.04,17.728 C179.04,19.1040069 178.552005,20.1599963 177.576,20.896 C176.599995,21.6320037 175.168009,22 173.28,22 L165.216,22 L165.216,6.16 Z M172.176,12.64 C173.664007,12.64 174.408,12.0640058 174.408,10.912 C174.408,9.75999424 173.664007,9.184 172.176,9.184 L169.2,9.184 L169.2,12.64 L172.176,12.64 Z M172.584,19.096 C173.320004,19.096 173.875998,18.9440015 174.252,18.64 C174.628002,18.3359985 174.816,17.8960029 174.816,17.32 C174.816,16.7599972 174.628002,16.3320015 174.252,16.036 C173.875998,15.7399985 173.320004,15.592 172.584,15.592 L169.2,15.592 L169.2,19.096 L172.584,19.096 Z M185.76,22 L181.632,22 L181.632,6.16 L185.76,6.16 L185.76,22 Z M202.584,9.352 L197.424,9.352 L197.424,22 L193.296,22 L193.296,9.352 L188.112,9.352 L188.112,6.16 L202.584,6.16 L202.584,9.352 Z" id="VOWPALWABBIT" fill-rule="nonzero"></path>
                        </g>
                    </g>
                    <g id="Group-3" transform="translate(0.000000, 16.000000)">
                        <mask id="mask-2" fill="white">
                            <use xlink:href="#path-1"></use>
                        </mask>
                        <g id="Clip-2"></g>
                        <path d="M41.9813276,24.9175791 C41.9813276,13.8292163 32.9500091,14.0405396 32.9500091,14.0405396 C32.0605466,9.2330546 30.5043762,5.39449409 29.0122432,2.95421329 C27.2686285,0.654814673 25.9862033,0 25.9862033,0 C24.433145,1.05110573 23.6649347,5.90914536 23.6649347,5.90914536 C21.2590408,1.77276757 18.4947765,1.57941395 18.4947765,1.57941395 C14.9073614,12.5619954 25.5641545,16.6805233 25.5641545,16.6805233 C14.9631398,16.6805233 9.49960631,22.5600786 6.88927134,26.9815751 C6.00639209,28.5787191 5.40479894,30.0454034 5.02572104,31.1057335 L4.49702287,32.7908091 C2.84928484,31.8162542 0.017033097,31.7817524 0.017033097,31.7817524 C-0.418062629,43.820471 7.62683939,42.0251815 7.62683939,42.0251815 C7.62683939,43.7148094 9.84265565,45 9.84265565,45 L27.1467778,45 C27.1467778,45 26.8872764,42.8218367 25.0774697,41.6425474 C24.7795458,41.2040875 24.6799585,40.8190574 25.0346184,40.4133023 C26.0320469,39.2724681 26.7444788,40.7698205 26.7444788,40.7698205 L27.4953331,41.7830702 C29.6309529,44.4419819 31.1160238,44.9275223 31.7469425,45 L32.0875979,45 C30.8645421,41.2514076 30.9082312,37.9785322 30.9082312,37.9785322 C30.7234202,33.2048302 34.2161557,28.8249036 34.2161557,28.8249036 C42.7627045,28.8249036 41.9813276,24.9175791 41.9813276,24.9175791" id="Fill-1" fill="#FEFEFE" mask="url(#mask-2)"></path>
                    </g>
                </g>
            </g>
        </g>
    </g>
</svg>
      </a>
    </div>

    <div class="nav">
      <a
        href="https://github.com/VowpalWabbit/vowpal_wabbit/wiki"
        target="_blank"
        class="nav_item"
      >
        <?xml version="1.0" encoding="UTF-8"?>
<svg width="22px" height="30px" viewBox="0 0 22 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 53 (72520) - https://sketchapp.com -->
    <title>noun_Document_1743070</title>
    <desc>Created with Sketch.</desc>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Artboard" fill="#FFFFFF" fill-rule="nonzero">
            <g id="noun_Document_1743070">
                <g id="Group">
                    <path d="M1.03125,0.0158587653 C0.451034375,0.0199131328 0.003540625,0.591827667 0,1.03796823 L0,28.9756438 C6.875e-05,29.5107863 0.491321875,29.9976852 1.03125,29.9977533 L20.96875,29.9977533 C21.5086781,29.9976852 21.9999312,29.5107863 22,28.9756438 L22,7.17062498 C22,6.90279483 21.8899656,6.63635134 21.6992187,6.44663078 L15.5117187,0.313974024 C15.3202844,0.124924659 15.0514719,0.0152148363 14.78125,0.0158587653 L1.03125,0.0158587653 Z M2.0625,2.06007769 L13.75,2.06007769 L13.75,7.17062498 C13.7500687,7.70578787 14.2413219,8.19268334 14.78125,8.19273444 L19.9375,8.19273444 L19.9375,27.9535344 L2.0625,27.9535344 L2.0625,2.06007769 Z M15.8125,3.49741911 L18.4872875,6.14851552 L15.8125,6.14851552 L15.8125,3.49741911 Z M4.8125,5.80781237 C4.242975,5.80781237 3.78125,6.26541078 3.78125,6.82992183 C3.78125,7.39439882 4.242975,7.85203129 4.8125,7.85203129 L9.625,7.85203129 C10.1945594,7.85203129 10.65625,7.39439882 10.65625,6.82992183 C10.65625,6.26541078 10.1945594,5.80781237 9.625,5.80781237 L4.8125,5.80781237 Z M4.8125,11.2590628 C4.242975,11.2590628 3.78125,11.7166612 3.78125,12.2811723 C3.78125,12.8456493 4.242975,13.3032817 4.8125,13.3032817 L17.1875,13.3032817 C17.7570594,13.3032817 18.21875,12.8456493 18.21875,12.2811723 C18.21875,11.7166612 17.7570594,11.2590628 17.1875,11.2590628 L4.8125,11.2590628 Z M4.8125,16.7103303 C4.242975,16.7103303 3.78125,17.1679287 3.78125,17.7324398 C3.78125,18.2969168 4.242975,18.7545492 4.8125,18.7545492 L17.1875,18.7545492 C17.7570594,18.7545492 18.21875,18.2969168 18.21875,17.7324398 C18.21875,17.1679287 17.7570594,16.7103303 17.1875,16.7103303 L4.8125,16.7103303 Z M4.8125,22.1615808 C4.242975,22.1615808 3.78125,22.6191792 3.78125,23.1836902 C3.78125,23.7481672 4.242975,24.2057997 4.8125,24.2057997 L17.1875,24.2057997 C17.7570594,24.2057997 18.21875,23.7481672 18.21875,23.1836902 C18.21875,22.6191792 17.7570594,22.1615808 17.1875,22.1615808 L4.8125,22.1615808 Z" id="Shape"></path>
                </g>
            </g>
        </g>
    </g>
</svg>

        <span class="nav_item_text">Documentation</span>
      </a>

      <a
        href="https://github.com/VowpalWabbit/vowpal_wabbit"
        target="_blank"
        class="nav_item"
      >
        <?xml version="1.0" encoding="UTF-8"?>
<svg width="30px" height="30px" viewBox="0 0 30 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 53 (72520) - https://sketchapp.com -->
    <title>GitHub</title>
    <desc>Created with Sketch.</desc>
    <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="HD_Desktop_header_Home" transform="translate(-1538.000000, -58.000000)" fill="#FFFFFF">
            <g id="Header">
                <path d="M1568,73.7951128 C1567.94603,74.2583723 1567.89891,74.7224863 1567.83682,75.1847206 C1567.56271,77.2238487 1566.86543,79.1138828 1565.7732,80.8526868 C1564.55268,82.7956941 1562.9969,84.4188114 1561.05088,85.6538569 C1560.03339,86.2996179 1558.94817,86.8066231 1557.80753,87.1895684 C1557.17559,87.4016322 1556.73848,87.0743943 1556.73531,86.4093237 C1556.72907,85.1020808 1556.73745,83.7947524 1556.73164,82.487424 C1556.72804,81.6908602 1556.64825,80.9063436 1556.21259,80.2087201 C1556.0855,80.0052003 1555.92463,79.8226135 1555.77393,79.6234512 C1556.35935,79.5140871 1556.9463,79.4362506 1557.51632,79.2916849 C1559.04696,78.9034423 1560.41543,78.2275208 1561.34791,76.8924242 C1562.03287,75.9115647 1562.34632,74.7851144 1562.48436,73.6108172 C1562.59169,72.6982249 1562.62222,71.7826422 1562.42971,70.8740656 C1562.23608,69.9599354 1561.84044,69.1418405 1561.22834,68.4359293 C1561.07756,68.2620575 1561.04763,68.1215929 1561.12221,67.896713 C1561.52468,66.6818314 1561.3562,65.491984 1560.9042,64.3262309 C1560.87829,64.2595017 1560.76574,64.1973008 1560.68569,64.1853391 C1560.15364,64.1058793 1559.65196,64.2559986 1559.18533,64.4761793 C1558.42904,64.8332361 1557.69764,65.242668 1556.9487,65.6159585 C1556.82229,65.6790137 1556.64782,65.7219904 1556.51706,65.6889249 C1554.16941,65.0964789 1551.82595,65.097077 1549.47805,65.6883268 C1549.34078,65.7228448 1549.14638,65.677134 1549.02331,65.5987849 C1548.07109,64.9919849 1547.06446,64.5120644 1545.97001,64.2236166 C1545.9511,64.218661 1545.93272,64.2115694 1545.91364,64.2077246 C1545.22551,64.0670892 1545.09971,64.1456947 1544.9036,64.8108506 C1544.58682,65.884755 1544.5296,66.9550708 1544.90668,68.0296587 C1544.93627,68.1139033 1544.90129,68.2616303 1544.8404,68.3306664 C1543.60397,69.7341156 1543.31096,71.3989279 1543.46559,73.1936101 C1543.55933,74.2817831 1543.81162,75.3262104 1544.29869,76.3083514 C1544.97176,77.6654063 1546.11181,78.4952066 1547.4926,78.982475 C1548.35956,79.2884382 1549.27852,79.4473579 1550.18824,79.6758264 C1550.19526,79.6319098 1550.20056,79.6666842 1550.18568,79.6820635 C1549.71726,80.1697591 1549.45556,80.755028 1549.34531,81.4170227 C1549.33137,81.5007546 1549.27365,81.6203716 1549.20685,81.6454912 C1548.16482,82.0372369 1547.11706,82.2433199 1546.08683,81.6149888 C1545.61867,81.3295314 1545.27683,80.9169382 1545.00101,80.4479541 C1544.56852,79.712395 1543.95864,79.179074 1543.13923,78.9361661 C1542.84434,78.8487602 1542.50823,78.8709748 1542.19359,78.8892591 C1541.97909,78.9018189 1541.90862,79.062362 1542.05256,79.2422147 C1542.18529,79.4077988 1542.32025,79.5950849 1542.4978,79.6971865 C1543.28625,80.1507913 1543.72798,80.8753286 1544.08881,81.6641173 C1544.30382,82.1341266 1544.48812,82.6140471 1544.88675,82.9753759 C1545.52169,83.5510755 1546.29115,83.7682658 1547.11612,83.8044072 C1547.81434,83.834995 1548.51496,83.8107298 1549.24722,83.8107298 C1549.24611,83.8009041 1549.26073,83.8742123 1549.26167,83.9476058 C1549.27211,84.7377616 1549.2828,85.5279173 1549.28844,86.3180731 C1549.294,87.0913115 1548.82935,87.4109452 1548.0952,87.1563319 C1544.28705,85.8355039 1541.4928,83.3342269 1539.62819,79.7992882 C1538.22405,77.1372118 1537.78027,74.2780237 1538.09739,71.2935795 C1538.4294,68.1688416 1539.66702,65.4337134 1541.73193,63.0872551 C1543.89022,60.6347648 1546.57714,59.0045559 1549.78825,58.3523869 C1554.45335,57.4048494 1558.71409,58.3562318 1562.44442,61.3515269 C1565.27245,63.6222848 1567.02271,66.5767393 1567.72914,70.1361141 C1567.83314,70.6605492 1567.87265,71.197715 1567.94398,71.7286436 C1567.95792,71.832625 1567.9811,71.9354102 1568,72.0387934 L1568,73.7951128 Z" id="GitHub"></path>
            </g>
        </g>
    </g>
</svg>

        <span class="nav_item_text">GitHub</span>
      </a>
    </div>
  </div>
</div>

    <div class="container content tutorial_container">
      <div class="vw_breadcrumb">
        <a class="home" href="/vowpalwabbit.github.io">
          Home
        </a>
        <span class="title">
          Get started with Contextual Bandits
        </span>
      </div>
      <a
        href="/blob/master/_guides/contextual_bandits.md"
        class="edit"
        title="Edit this page"
        target="_blank"
      >
        <i class="fa fa-pencil-square-o fa-lg" aria-hidden="true"></i>
      </a>
      <h1 id="contextual-bandits-in-vw">Contextual Bandits in VW</h1>

<p>The goal of this tutorial is to have you walk away with an understanding of Contextual Bandits, when CB can be used, how to run CB algorithms in Vowpal Wabbit (VW), and hopefully make you feel empowered and excited to use it on your own. This tutorial focuses on Python but VW is also supported in C++ and C#.</p>

<h2 id="what-is-a-contextual-bandit">What is a Contextual Bandit?</h2>

<p>Consider an application that interacts with its environment, such as a news website with users or a cloud controller with machines. Let’s call this application <em>APP</em>. This application repeatedly goes through the following:</p>
<ol>
  <li>Some context x arrives and is observed by <em>APP</em></li>
  <li><em>APP</em> chooses an action <em>a</em> from a set of actions <em>A</em> i.e. a ∈ A to take (A may depend on x)</li>
  <li>Some reward r for the chosen a is observed by <em>APP</em></li>
</ol>

<p>We want our application <em>APP</em> to take actions such that we get the highest possible reward. In machine learning parlance, we want a <em>model</em> that tells us which action to take.</p>

<p>This scenario is very similar to a traditional <a href="https://en.wikipedia.org/wiki/Multi-armed_bandit" target="_blank">Multi Armed Bandit (MAB)</a>. The term “multi-armed bandit” comes from a hypothetical experiment where a gambler must choose between multiple actions (i.e. slot machines, the “one-armed bandits”), each with an unknown payout. The goal is to maximize the payout by optimally choosing the best actions when odds and payouts are unknown.</p>

<p>In MAB, the gambler has no information at all to make a decision. However, our application <em>APP</em> differs from MAB because we have some information available to the <em>APP</em> which is the “context”. Contextual Bandits uses additional information i.e. context available to make better decisions while choosing actions. Hence, the name “contextual” bandits.</p>

<p>In the contextual bandit problem, a learner (the gambler in the hypothetical experiment) repeatedly observes a context, chooses an action, and observes a loss/cost/reward for the chosen action only.</p>

<p>We use the term “policy” many times in this tutorial. For those new to RL, let’s try to understand the distinction between <em>model</em> and <em>policy</em>. In essence “policy” for RL is roughly equivalent to “model”.  The word “model”, as used in machine learning essentially means “learned function”. When someone says “policy”, it is more specific than “model”, because it indicates this is a model that acts in the world.</p>

<p>In Contextual Bandits, the contexts and actions are usually represented as feature vectors. <em>APP</em> chooses actions by applying a policy <em>π</em> that takes a context as input and returns an action. The goal is to find a policy that maximizes average reward over a sequence of interactions.</p>

<h2 id="real-world-examples-of-contextual-bandit"><span data-ref="DBLP:journals/corr/AgarwalBCHLLLMO16">Real world examples of contextual bandit</span></h2>

<ol>
  <li>News website
    <ul>
      <li>Decision to optimize: which article to display to user</li>
      <li>Context: user features - browsing history, location, device, time of day</li>
      <li>Actions: available news articles</li>
      <li>Reward: user engagement - click or no click</li>
    </ul>
  </li>
  <li>Cloud Controller
    <ul>
      <li>Decision to optimize: wait time before reboot of unresponsive machine</li>
      <li>Context: machine hardware spec - sku, os etc., failure history, location, load</li>
      <li>Actions: minutes - {1 ,2 , …N}</li>
      <li>Reward: - total downtime</li>
    </ul>
  </li>
</ol>

<h2 id="cb-algorithms">CB algorithms</h2>

<p>The focal point of Contextual Bandit learning research is efficient exploration algorithms. For more details, please refer to the <a href="https://arxiv.org/pdf/1802.04064.pdf" target="_blank">Contextual Bandit bake-off paper</a>.</p>

<p>VW offers various CB algorithms. For more details, please refer to the <a href="https://github.com/VowpalWabbit/vowpal_wabbit/wiki/Contextual-Bandit-algorithms" target="_blank">Github wiki</a>.</p>

<p>Having said that, we have tried to summarize as much as we can in this tutorial with the intention that you learn a quite a bit about CB in general and working with CB algorithms in VW.</p>

<h2 id="vw-cb-functionalities">VW CB functionalities</h2>

<p>In this section we go over different CB functionalities offered by VW, understand how to format data and understand the results.</p>

<h3 id="specifying-cb-approach">Specifying CB approach</h3>

<p>Multiple policy evaluation approaches can be used when optimizing a policy. VW offers 4 approaches that you can specify using <code class="highlighter-rouge">--cb_type</code>:</p>

<ul>
  <li><span data-ref="doi:10.1080/01621459.1952.10483446">Inverse Propensity Score</span> <code class="highlighter-rouge">--cb_type ips</code></li>
  <li><span data-ref="DBLP:conf/icml/JiangL16 DBLP:conf/icml/DudikLL11">Doubly Robust</span> <code class="highlighter-rouge">--cb_type dr</code></li>
  <li>Direct Method <code class="highlighter-rouge">--cb_type dm</code></li>
  <li><span data-ref="bietti2018a Karampatziakis:2011:OIW:3020548.3020594">Multi Task Regression/Importance Weighted Regression</span> <code class="highlighter-rouge">--cb_type mtr</code></li>
</ul>

<p>For more details, please refer to the <a href="https://arxiv.org/pdf/1802.04064.pdf" target="_blank">Contextual Bandit bake-off paper</a>.</p>

<p><strong>CB algorithms</strong> in VW can be classified as:</p>

<ol>
  <li><code class="highlighter-rouge">--cb</code>: CB module which allows you to optimize predictor based on already collected CB data, CB without exploration</li>
  <li><code class="highlighter-rouge">--cb_explore</code>: CB learning algorithm for when the maximum number of actions is known ahead of time and semantics of actions stays the same across examples</li>
  <li><code class="highlighter-rouge">--cb_explore_adf</code>: CB learning algorithm for when the set of actions changes over time or we have rich information for each action</li>
</ol>

<h3 id="specifying-exploration-algorithms">Specifying exploration algorithms</h3>

<p>VW offers 5 exploration algorithms</p>

<ul>
  <li>Explore-first <code class="highlighter-rouge">--first</code></li>
  <li>Epsilon-greedy <code class="highlighter-rouge">--epsilon</code></li>
  <li><span data-ref="DBLP:journals/corr/abs-1202-1334 DBLP:journals/corr/EcklesK14">Bagging Explorer</span> <code class="highlighter-rouge">--bag</code></li>
  <li><span data-ref="DBLP:journals/corr/AgarwalHKLLS14">Online Cover</span> <code class="highlighter-rouge">--cover</code></li>
  <li><span data-ref="DBLP:journals/corr/abs-1811-04383">Softmax Explorer</span> <code class="highlighter-rouge">--softmax</code> (only supported for <code class="highlighter-rouge">--cb_explore_adf</code>)</li>
</ul>

<p>For more details, please refer to the <a href="https://github.com/VowpalWabbit/vowpal_wabbit/wiki/Contextual-Bandit-algorithms" target="_blank">Github wiki</a>.</p>

<h2 id="input-format">Input Format</h2>

<p>Let’s recall - A CB problem has four main components:</p>

<ul>
  <li><strong>Context (x)</strong>: the additional information which helps in choosing action</li>
  <li><strong>Action (a)</strong>: the action chosen from a set of possible actions <em>A</em></li>
  <li><strong>Probability (p)</strong>: probability of choosing <em>a</em> from <em>A</em></li>
  <li><strong>Cost/Reward (r)</strong>: reward received for action <em>a</em></li>
</ul>

<p>We next look at the input format for different CB types that VW offers</p>

<h3 id="1---cb">1. <code class="highlighter-rouge">--cb</code></h3>

<p><code class="highlighter-rouge">--cb &lt;number_of_actions&gt;</code>: e.g. –cb 4 specifies we want to use CB module and our data has a total of 4 actions.</p>

<p>Each example must be a separate line in your data file and must follow the format:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>action:cost:probability | features
</code></pre></div></div>
<p>You may notice that the left side of the | is different to the example in the linear regression tutorial. This is because CB has a different label type. The format is the same on the right side of the |, and in this case they are specified by the context <em>x</em>.</p>

<p>Sample data file (train.dat) with five examples:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1:2:0.4 | a c
3:0.5:0.2 | b d
4:1.2:0.5 | a b c
2:1:0.3 | b c
3:1.5:0.7 | a d
</code></pre></div></div>

<p>Usage: <code class="highlighter-rouge">./vw -d train.dat --cb 4</code></p>

<p><strong>Note:</strong> The usage mentioned in this section is for using VW command line. However, in the example tutorial below, we also see how to use it in Python.</p>

<h3 id="2---cb_explore">2. <code class="highlighter-rouge">--cb_explore</code></h3>

<p><code class="highlighter-rouge">--cb_explore &lt;number_of_actions&gt;</code>: e.g. <code class="highlighter-rouge">--cb_explore 4</code> specifies our examples explore a total of 4 actions. Since this is exploring through the action space, you also have to specify which algorithm you want to use for exploration.</p>

<p>The example format is same as in the case of <code class="highlighter-rouge">--cb</code></p>

<p>Usage:</p>
<ul>
  <li><code class="highlighter-rouge">./vw -d train.dat --cb_explore 4 --first 2</code>
    <ul>
      <li>In this case, on the first two actions, we take each of the 4 actions with probability 1/4.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">./vw -d train.dat --cb_explore 4 --epsilon 0.2</code>
    <ul>
      <li>In this case, the prediction of the current learned policy is taken with probability 1 - <em>epsilon</em> (i.e. 80% of the time) and with the remaining (i.e. 20%) epsilon probability an action is chosen uniformly at random.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">./vw -d train.dat --cb_explore 4 --bag 5</code>
    <ul>
      <li>In this case, we use an ensemble approach. We take an argument <em>m</em> for <code class="highlighter-rouge">--bag</code> and train <em>m</em> different policies, i.e. 5 in the above example. The policies differ because they are being trained on different subsets of data, with each example going to a subset of the <em>m</em> policies.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">./vw -d train.dat --cb_explore 4 --cover 3</code>
    <ul>
      <li>In this case, similar to bagging <em>m</em> different policies are trained but unlike bagging the training of these policies is explicitly optimized to result in a diverse set of predictions, choosing all the actions which are not already learned to be bad in a given context. This is a <em>theoretically optimal</em> exploration algorithm. If you are curious to learn more, you can read more about it in this <a href="http://arxiv.org/abs/1402.0555" target="_blank">paper</a>.</li>
    </ul>
  </li>
</ul>

<h3 id="3---cb_explore_adf">3. <code class="highlighter-rouge">--cb_explore_adf</code></h3>

<p><code class="highlighter-rouge">--cb_explore_adf</code> e.g. <code class="highlighter-rouge">--cb_explore_adf</code> Since this exploring through the action space, you also have to specify which algorithm you want to use for exploration.</p>

<p>The example format for this one is a little bit different from the other two cases because the action set changes over time or we have rich information for each action. Hence, it is best to create features for every (context, action) pair rather than features associated only with context and shared across all actions.</p>

<p>Let’s look at it in more detail to understand it better -</p>
<ul>
  <li>Each example now spans multiple lines, with one line per action</li>
  <li>For each action, we have the label information (action, cost, probability), if known, as before</li>
  <li>The action field <em>a</em> is ignored now since actions are identified by line numbers, and typically set to 0</li>
  <li>The semantics of cost and probability are same as before</li>
  <li>Each example is also allowed to specify the label information on precisely one action</li>
  <li>A newline signals end of a multiline example</li>
  <li>Additionally, we can specify contextual features which are shared across all actions in a line at the beginning of an example, which always has a <code class="highlighter-rouge">shared</code> label, as in the second multiline example below. Since the shared line is not associated with any action, it should never contain the label information.</li>
</ul>

<p>Sample data file (train.dat) with two examples:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| a:1 b:0.5
0:0.1:0.75 | a:0.5 b:1 c:2

shared | s_1 s_2
0:1.0:0.5 | a:1 b:1 c:1
| a:0.5 b:2 c:1
</code></pre></div></div>
<p>In the first example above, we have 2 actions, one line for each. The first line represents the first action and it has two action dependent features <em>a</em> and <em>b</em>. The second line represents the second action and it has three action dependent features <em>a</em>, <em>b</em> and <em>c</em>. The second action was the chosen action for the example and it follows the format</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>action:cost:probability | features
0:0.1:0.75 |
</code></pre></div></div>
<p>Action 0 is ignored, has cost 0.1 and probability of 0.75.</p>

<p>Usage:</p>

<ul>
  <li><code class="highlighter-rouge">./vw -d train_adf.dat --cb_explore_adf</code></li>
  <li><code class="highlighter-rouge">./vw -d train.dat --cb_explore_adf --first 2</code></li>
  <li><code class="highlighter-rouge">./vw -d train.dat --cb_explore_adf --epsilon 0.1</code></li>
  <li><code class="highlighter-rouge">./vw -d train.dat --cb_explore_adf --bag 5</code></li>
  <li><code class="highlighter-rouge">./vw -d train.dat --cb_explore_adf --softmax --lambda 10</code></li>
</ul>

<p>In the case of the softmax explorer, which uses the policy to not only predict an action but also predict a score indicating the quality of each action. A distribution is then created with the probability of action a being is proportional to exp(lambda*score(x,a)). Here lambda is a parameter, which leads to uniform exploration for lambda = 0, and stops exploring as lambda approaches infinity. In general, this provides another nice knob for controlled exploration based on the uncertainty in the learned policy.</p>

<h2 id="lets-create-a-small-data-set">Let’s create a small data-set</h2>

<h3 id="set-up">Set-up</h3>
<p>Load required packages</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">sklearn</span> <span class="k">as</span> <span class="n">sk</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
</code></pre></div></div>

<p>Install <a href="https://github.com/VowpalWabbit/vowpal_wabbit/tree/master/python">Vowpal Wabbit Python package</a></p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>boost
apt-get <span class="nb">install </span>libboost-program-options-dev zlib1g-dev libboost-python-dev <span class="nt">-y</span>
pip <span class="nb">install </span>vowpalwabbit
</code></pre></div></div>

<p>Generate sample training data that could originate from previous random trial, e.g. AB test, for the CB to explore. The data here is equivalent to the <a href="https://github.com/VowpalWabbit/vowpal_wabbit/wiki/Logged-Contextual-Bandit-Example" target="_blank">wiki example</a>.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train_data</span> <span class="o">=</span> <span class="p">[{</span><span class="s">'action'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'cost'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'probability'</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span> <span class="s">'feature1'</span><span class="p">:</span> <span class="s">'a'</span><span class="p">,</span> <span class="s">'feature2'</span><span class="p">:</span> <span class="s">'c'</span><span class="p">,</span> <span class="s">'feature3'</span><span class="p">:</span> <span class="s">''</span><span class="p">},</span>
              <span class="p">{</span><span class="s">'action'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'cost'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'probability'</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s">'feature1'</span><span class="p">:</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'feature2'</span><span class="p">:</span> <span class="s">'d'</span><span class="p">,</span> <span class="s">'feature3'</span><span class="p">:</span> <span class="s">''</span><span class="p">},</span>
              <span class="p">{</span><span class="s">'action'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">'cost'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'probability'</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">'feature1'</span><span class="p">:</span> <span class="s">'a'</span><span class="p">,</span> <span class="s">'feature2'</span><span class="p">:</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'feature3'</span><span class="p">:</span> <span class="s">''</span><span class="p">},</span>
              <span class="p">{</span><span class="s">'action'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'cost'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'probability'</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s">'feature1'</span><span class="p">:</span> <span class="s">'a'</span><span class="p">,</span> <span class="s">'feature2'</span><span class="p">:</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'feature3'</span><span class="p">:</span> <span class="s">'c'</span><span class="p">},</span>
              <span class="p">{</span><span class="s">'action'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'cost'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'probability'</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s">'feature1'</span><span class="p">:</span> <span class="s">'a'</span><span class="p">,</span> <span class="s">'feature2'</span><span class="p">:</span> <span class="s">'d'</span><span class="p">,</span> <span class="s">'feature3'</span><span class="p">:</span> <span class="s">''</span><span class="p">}]</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>

<span class="c1"># Add index to data frame
</span><span class="n">train_df</span><span class="p">[</span><span class="s">'index'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">"index"</span><span class="p">)</span>
</code></pre></div></div>

<p>Generate some test data that you want the CB to make decisions for, e.g. features describing new users, for the CB to exploit.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_data</span> <span class="o">=</span> <span class="p">[{</span><span class="s">'feature1'</span><span class="p">:</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'feature2'</span><span class="p">:</span> <span class="s">'c'</span><span class="p">,</span> <span class="s">'feature3'</span><span class="p">:</span> <span class="s">''</span><span class="p">},</span>
            <span class="p">{</span><span class="s">'feature1'</span><span class="p">:</span> <span class="s">'a'</span><span class="p">,</span> <span class="s">'feature2'</span><span class="p">:</span> <span class="s">''</span><span class="p">,</span> <span class="s">'feature3'</span><span class="p">:</span> <span class="s">'b'</span><span class="p">},</span>
            <span class="p">{</span><span class="s">'feature1'</span><span class="p">:</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'feature2'</span><span class="p">:</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'feature3'</span><span class="p">:</span> <span class="s">''</span><span class="p">},</span>
            <span class="p">{</span><span class="s">'feature1'</span><span class="p">:</span> <span class="s">'a'</span><span class="p">,</span> <span class="s">'feature2'</span><span class="p">:</span> <span class="s">''</span><span class="p">,</span> <span class="s">'feature3'</span><span class="p">:</span> <span class="s">'b'</span><span class="p">}]</span>

<span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>

<span class="c1"># Add index to data frame
</span><span class="n">test_df</span><span class="p">[</span><span class="s">'index'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">"index"</span><span class="p">)</span>
</code></pre></div></div>

<p>Let’s look at the dataframes</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">test_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="lets-try---cb-in-python">Let’s try <code class="highlighter-rouge">--cb</code> in Python</h3>

<p>First, create the Python model - this stores the model parameters in the Python <code class="highlighter-rouge">vw</code> object. Here we use arguments for a Contextual Bandit with four possible actions.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">vowpalwabbit</span> <span class="kn">import</span> <span class="n">pyvw</span>

<span class="n">vw</span> <span class="o">=</span> <span class="n">pyvw</span><span class="o">.</span><span class="n">vw</span><span class="p">(</span><span class="s">"--cb 4"</span><span class="p">)</span>
</code></pre></div></div>
<p>Note: You can pass <code class="highlighter-rouge">--quiet</code> if you want vw to stop talking while it’s working.</p>

<p>Next, for each train example we call learn on our vw model.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">train_df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
  <span class="n">action</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">"action"</span><span class="p">]</span>
  <span class="n">cost</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">"cost"</span><span class="p">]</span>
  <span class="n">probability</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">"probability"</span><span class="p">]</span>
  <span class="n">feature1</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">"feature1"</span><span class="p">]</span>
  <span class="n">feature2</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">"feature2"</span><span class="p">]</span>
  <span class="n">feature3</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">"feature3"</span><span class="p">]</span>

  <span class="c1"># Construct the example in the required vw format.
</span>  <span class="n">learn_example</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">probability</span><span class="p">)</span> <span class="o">+</span> <span class="s">" | "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature1</span><span class="p">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature2</span><span class="p">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature3</span><span class="p">)</span>

  <span class="c1"># Here we do the actual learning.
</span>  <span class="n">vw</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">learn_example</span><span class="p">)</span>
</code></pre></div></div>

<p>Use the model that was just trained on the train set to perform predictions on the test set. We construct the example as before but don’t include the label and pass it into predict instead of learn.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">test_df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
  <span class="n">feature1</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="s">"feature1"</span><span class="p">]</span>
  <span class="n">feature2</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="s">"feature2"</span><span class="p">]</span>
  <span class="n">feature3</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="s">"feature3"</span><span class="p">]</span>

  <span class="n">test_example</span> <span class="o">=</span> <span class="s">"| "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature1</span><span class="p">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature2</span><span class="p">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature3</span><span class="p">)</span>

  <span class="n">choice</span> <span class="o">=</span> <span class="n">vw</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_example</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">choice</span><span class="p">)</span>
</code></pre></div></div>
<p>The CB assigns every instance to action 3 as it should per the cost structure of the train data; you can play with the cost structure to see that the CB updates its predictions accordingly.</p>

<p>The model you just trained can be saved and loaded from a file. The <code class="highlighter-rouge">-i</code> argument means input regressor, telling vw to load a model from that file instead of starting from scratch.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vw</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">'cb.model'</span><span class="p">)</span>
<span class="k">del</span> <span class="n">vw</span>

<span class="n">vw</span> <span class="o">=</span> <span class="n">pyvw</span><span class="o">.</span><span class="n">vw</span><span class="p">(</span><span class="s">"--cb 4 -i cb.model"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vw</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s">'| a b'</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="whats-next">What’s next?</h2>

<ul>
  <li>Look through <a href="https://github.com/VowpalWabbit/vowpal_wabbit/tree/master/python/examples" target="_blank">example Python notebooks</a></li>
  <li>Explore more content in the <a href="https://github.com/VowpalWabbit/vowpal_wabbit/wiki/Tutorial#more-tutorials" target="_blank">tutorials section of the GitHub wiki</a></li>
  <li>Browse <a href="https://github.com/VowpalWabbit/vowpal_wabbit/wiki/Examples" target="_blank">examples on the GitHub wiki</a></li>
  <li>Check out the various <a href="https://github.com/VowpalWabbit/vowpal_wabbit/wiki/Command-Line-Arguments" target="_blank">command line options of VW</a></li>
</ul>

<p>We hope you have fun exploring VW!</p>

    </div>
    <div class="bibliography_container">
      <div class="container">
        <div class="row header">
          <div class="col-5">
            <h3>
              CITATIONS
            </h3>
          </div>
          <div class="col all_publications_link">
            <a href="/vowpalwabbit.github.io/publications">
              All publications
            </a>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <ol class="bibliography"><li><span id="DBLP:journals/corr/AgarwalBCHLLLMO16">Agarwal, A., Bird, S., Cozowicz, M., Hoang, L., Langford, J., Lee, S., … Slivkins, A. (2016). A Multiworld Testing Decision Service. <i>CoRR</i>, <i>abs/1606.03966</i>. Retrieved from http://arxiv.org/abs/1606.03966</span>
<a class="details" href="/vowpalwabbit.github.io/bibliography/DBLP_journals/corr/AgarwalBCHLLLMO16.html">Get .bib</a></li>
<li><span id="doi:10.1080/01621459.1952.10483446">Horvitz, D. G., &amp; Thompson, D. J. (1952). A Generalization of Sampling Without Replacement from a Finite Universe. <i>Journal of the American Statistical Association</i>, <i>47</i>(260), 663–685. https://doi.org/10.1080/01621459.1952.10483446</span>
<a class="details" href="/vowpalwabbit.github.io/bibliography/doi_10.1080/01621459.1952.10483446.html">Get .bib</a></li>
<li><span id="DBLP:conf/icml/JiangL16">Jiang, N., &amp; Li, L. (2016). Doubly Robust Off-policy Value Evaluation for Reinforcement Learning. In <i>Proceedings of the 33nd International Conference on Machine Learning,
               ICML 2016, New York City, NY, USA, June 19-24, 2016</i> (pp. 652–661). Retrieved from http://proceedings.mlr.press/v48/jiang16.html</span>
<a class="details" href="/vowpalwabbit.github.io/bibliography/DBLP_conf/icml/JiangL16.html">Get .bib</a></li>
<li><span id="DBLP:conf/icml/DudikLL11">Dudı́k Miroslav, Langford, J., &amp; Li, L. (2011). Doubly Robust Policy Evaluation and Learning. In <i>Proceedings of the 28th International Conference on Machine Learning,
               ICML 2011, Bellevue, Washington, USA, June 28 - July 2, 2011</i> (pp. 1097–1104). Retrieved from https://icml.cc/2011/papers/554_icmlpaper.pdf</span>
<a class="details" href="/vowpalwabbit.github.io/bibliography/DBLP_conf/icml/DudikLL11.html">Get .bib</a></li>
<li><span id="bietti2018a">Bietti, A., Agarwal, A., &amp; Langford, J. (2018). A Contextual Bandit Bake-off. arXiv:1802.04064v3 [stat.ML]. Retrieved from https://www.microsoft.com/en-us/research/publication/a-contextual-bandit-bake-off-2/</span>
<a class="details" href="/vowpalwabbit.github.io/bibliography/bietti2018a.html">Get .bib</a></li>
<li><span id="Karampatziakis:2011:OIW:3020548.3020594">Karampatziakis, N., &amp; Langford, J. (2011). Online Importance Weight Aware Updates. In <i>Proceedings of the Twenty-Seventh Conference on Uncertainty in Artificial Intelligence</i> (pp. 392–399). Arlington, Virginia, United States: AUAI Press. Retrieved from http://dl.acm.org/citation.cfm?id=3020548.3020594</span>
<a class="details" href="/vowpalwabbit.github.io/bibliography/Karampatziakis_2011_OIW_3020548.3020594.html">Get .bib</a></li>
<li><span id="DBLP:journals/corr/abs-1202-1334">Agarwal, A., Dudı́k Miroslav, Kale, S., Langford, J., &amp; Schapire, R. E. (2012). Contextual Bandit Learning with Predictable Rewards. <i>CoRR</i>, <i>abs/1202.1334</i>. Retrieved from http://arxiv.org/abs/1202.1334</span>
<a class="details" href="/vowpalwabbit.github.io/bibliography/DBLP_journals/corr/abs-1202-1334.html">Get .bib</a></li>
<li><span id="DBLP:journals/corr/EcklesK14">Eckles, D., &amp; Kaptein, M. (2014). Thompson sampling with the online bootstrap. <i>CoRR</i>, <i>abs/1410.4009</i>. Retrieved from http://arxiv.org/abs/1410.4009</span>
<a class="details" href="/vowpalwabbit.github.io/bibliography/DBLP_journals/corr/EcklesK14.html">Get .bib</a></li>
<li><span id="DBLP:journals/corr/AgarwalHKLLS14">Agarwal, A., Hsu, D. J., Kale, S., Langford, J., Li, L., &amp; Schapire, R. E. (2014). Taming the Monster: A Fast and Simple Algorithm for Contextual Bandits. <i>CoRR</i>, <i>abs/1402.0555</i>. Retrieved from http://arxiv.org/abs/1402.0555</span>
<a class="details" href="/vowpalwabbit.github.io/bibliography/DBLP_journals/corr/AgarwalHKLLS14.html">Get .bib</a></li>
<li><span id="DBLP:journals/corr/abs-1811-04383">Cortes, D. (2018). Adapting multi-armed bandits policies to contextual bandits scenarios. <i>CoRR</i>, <i>abs/1811.04383</i>. Retrieved from http://arxiv.org/abs/1811.04383</span>
<a class="details" href="/vowpalwabbit.github.io/bibliography/DBLP_journals/corr/abs-1811-04383.html">Get .bib</a></li></ol>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid footer_container">
  <div class="container">
    <div class="row align-items-center">
      <div class="col">
        <span class="title">Sponsored by</span>
        <img class="microsoft_logo" src="/vowpalwabbit.github.io/assets/images/microsoft_logo.svg" />
      </div>
    </div>
  </div>
</div>


    <div class="overlay">
    </div>
  </body>
</html>
